{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth';\nimport { auth, db } from \"../firebase/firebaseConfig\";\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState('user'),\n    _useState4 = _slicedToArray(_useState3, 2),\n    role = _useState4[0],\n    setRole = _useState4[1];\n  var loadUserRole = function () {\n    var _ref2 = _asyncToGenerator(function* (uid) {\n      try {\n        var ref = doc(db, 'users', uid);\n        var snap = yield getDoc(ref);\n        if (snap.exists()) {\n          var _ref3;\n          setRole((_ref3 = snap.data().role) != null ? _ref3 : 'user');\n        } else {\n          setRole('user');\n        }\n      } catch (error) {\n        console.log('Failed to load role', error);\n        setRole('user');\n      }\n    });\n    return function loadUserRole(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  useEffect(function () {\n    var unsubscribe = onAuthStateChanged(auth, function () {\n      var _ref4 = _asyncToGenerator(function* (currentUser) {\n        console.log('AUTH STATE CHANGED:', currentUser);\n        if (currentUser) {\n          setUser(currentUser);\n          yield loadUserRole(currentUser.uid);\n        } else {\n          console.log('USER IS NULL â†’ LOGGED OUT');\n          setUser(null);\n          setRole('user');\n        }\n      });\n      return function (_x2) {\n        return _ref4.apply(this, arguments);\n      };\n    }());\n    return unsubscribe;\n  }, []);\n  var login = function () {\n    var _ref5 = _asyncToGenerator(function* (email, password) {\n      try {\n        var res = yield signInWithEmailAndPassword(auth, email, password);\n        setUser(res.user);\n        yield loadUserRole(res.user.uid);\n        return true;\n      } catch (error) {\n        console.log(error);\n        return false;\n      }\n    });\n    return function login(_x3, _x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var register = function () {\n    var _ref6 = _asyncToGenerator(function* (data) {\n      try {\n        var res = yield createUserWithEmailAndPassword(auth, data.email, data.password);\n        yield setDoc(doc(db, 'users', res.user.uid), {\n          name: data.name,\n          surname: data.surname,\n          phone: data.phone,\n          address: data.address,\n          role: 'user',\n          createdAt: new Date()\n        });\n        setUser(res.user);\n        setRole('user');\n        return true;\n      } catch (error) {\n        console.log(error);\n        return false;\n      }\n    });\n    return function register(_x5) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref7 = _asyncToGenerator(function* () {\n      console.log('SIGNING OUT...');\n      yield signOut(auth);\n      console.log('SIGNED OUT FROM FIREBASE');\n    });\n    return function logout() {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      user: user,\n      role: role,\n      isAdmin: role === 'admin',\n      login: login,\n      register: register,\n      logout: logout\n    },\n    children: children\n  });\n};\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","onAuthStateChanged","auth","db","doc","setDoc","getDoc","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","role","setRole","loadUserRole","_ref2","_asyncToGenerator","uid","ref","snap","exists","_ref3","data","error","console","log","_x","apply","arguments","unsubscribe","_ref4","currentUser","_x2","login","_ref5","email","password","res","_x3","_x4","register","_ref6","name","surname","phone","address","createdAt","Date","_x5","logout","_ref7","Provider","value","isAdmin","useAuth"],"sources":["D:/Sekomane/Documents/React Native Restaurant App (7)/React Native Restaurant App/context/AuthContext.tsx"],"sourcesContent":["import React, {\n  createContext,\n  useContext,\n  useState,\n  useEffect\n} from 'react';\n\nimport {\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  signOut,\n  onAuthStateChanged\n} from 'firebase/auth';\n\nimport { auth, db } from '../firebase/firebaseConfig';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\n\n/* ================= TYPES ================= */\n\nexport type RegisterData = {\n  email: string;\n  password: string;\n  name: string;\n  surname: string;\n  phone: string;\n  address: string;\n};\n\ntype Role = 'admin' | 'user';\n\ntype AuthContextType = {\n  user: any;\n  role: Role;\n  isAdmin: boolean;\n  login: (email: string, password: string) => Promise<boolean>;\n  register: (data: RegisterData) => Promise<boolean>;\n  logout: () => Promise<void>;\n};\n\n/* ================= CONTEXT ================= */\n\nconst AuthContext = createContext<AuthContextType>({} as AuthContextType);\n\n/* ================= PROVIDER ================= */\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({\n  children\n}) => {\n  const [user, setUser] = useState<any>(null);\n  const [role, setRole] = useState<Role>('user');\n\n  /* ---------- Load role from Firestore ---------- */\n  const loadUserRole = async (uid: string) => {\n    try {\n      const ref = doc(db, 'users', uid);\n      const snap = await getDoc(ref);\n\n      if (snap.exists()) {\n        setRole((snap.data().role as Role) ?? 'user');\n      } else {\n        setRole('user');\n      }\n    } catch (error) {\n      console.log('Failed to load role', error);\n      setRole('user');\n    }\n  };\n\n  /* ---------- AUTH STATE LISTENER (CRITICAL) ---------- */\nuseEffect(() => {\n  const unsubscribe = onAuthStateChanged(auth, async currentUser => {\n    console.log('AUTH STATE CHANGED:', currentUser);\n\n    if (currentUser) {\n      setUser(currentUser);\n      await loadUserRole(currentUser.uid);\n    } else {\n      console.log('USER IS NULL â†’ LOGGED OUT');\n      setUser(null);\n      setRole('user');\n    }\n  });\n\n  return unsubscribe;\n}, []);\n\n\n  /* ---------- LOGIN ---------- */\n  const login = async (email: string, password: string) => {\n    try {\n      const res = await signInWithEmailAndPassword(auth, email, password);\n      setUser(res.user);\n      await loadUserRole(res.user.uid);\n      return true;\n    } catch (error) {\n      console.log(error);\n      return false;\n    }\n  };\n\n  /* ---------- REGISTER ---------- */\n  const register = async (data: RegisterData) => {\n    try {\n      const res = await createUserWithEmailAndPassword(\n        auth,\n        data.email,\n        data.password\n      );\n\n      await setDoc(doc(db, 'users', res.user.uid), {\n        name: data.name,\n        surname: data.surname,\n        phone: data.phone,\n        address: data.address,\n        role: 'user', // ðŸ” DEFAULT ROLE\n        createdAt: new Date()\n      });\n\n      setUser(res.user);\n      setRole('user');\n      return true;\n    } catch (error) {\n      console.log(error);\n      return false;\n    }\n  };\n\n  /* ---------- LOGOUT ---------- */\nconst logout = async () => {\n  console.log('SIGNING OUT...');\n  await signOut(auth);\n  console.log('SIGNED OUT FROM FIREBASE');\n};\n\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        role,\n        isAdmin: role === 'admin',\n        login,\n        register,\n        logout\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\n/* ================= HOOK ================= */\n\nexport const useAuth = () => useContext(AuthContext);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}